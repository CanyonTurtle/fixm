<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fixm Demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: monospace;
            color: white;
        }
        
        .container {
            text-align: center;
            max-width: 800px;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: #333;
            color: white;
            border: 1px solid #666;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: monospace;
        }
        
        button:hover {
            background: #555;
        }
        
        canvas {
            border: 2px solid #333;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fixm Game Library Demo</h1>
        
        <!-- Spritesheet definition using web components -->
        <fixm-spritesheet name="test">
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAAIACAIAAAB7GkOtAAANIElEQVR4nOzXj7cXdH3HcW+7tMH8gZZLTHe6DnR5Oiv1MH820Rplm05OpqK0u4MpqbFp3kMguZBQBydDRyaaqKvNke0sM23GjKYndUuQJSQccgNOo51hQXJBJ8K2v+J1zs55PR5/wOtzzz3f733e9+Daof84KOmZs4+M7v/B/O3R/R/vWBPd3/3P06L7F/3NSHR/xpiJ0f1nxpwc3d/8yUOj+7Ov3hjdX3n/09H9k0++Lrr/xatfjO4vvmVndH/7yQuj+w/8y03R/bdE1wH4f0sAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQafMucb0cf+MlPZ0b3d510U3T/3C/Ni+5PvOW70f1j3/aR6P7P9u+M7r+6dWN0/4ZH3h7dX3TuH0f3F+59OLr/yiGXRfd/Ze03o/sPLV0f3X9qzPnR/fvGjkb3XQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQKnBx/bcFX3gqBXzovsHtq6O7h+8b0p0/0tL10X3dy3aGt0/4oEN0f2/uuVD0f3lT90X3X/md94Z3Z//5ZOi+9ct+5Po/nm/tTa6v+dbS6P7QxOnR/ffduKu6L4LAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoNbD6ybnRByZ/487o/iM7BqP7Dx0WnT/o2TN+Et3/+fJTovu733FjdH/CnCXR/Rvm/ii6/+iCmdH95047L7r/vXOuj+6/cONXovs/XDYpur9/0uvR/ZFP/nl03wUAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQauGLKuOgDC8/4r+j+7Hcvi+5vHbwpun/sd98X3b9gODp/0BGz747unzM5+/l8fMKm6P6+o0ei++tffzm6/8zqU6P7h9+8ILp/w/I7ovsjv35idP/Dr14d3XcBAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBr7zhauiD0yd/uPo/r9/YGV0/6n5e6P71xx+a3T/3nMXR/eHn9wf3Z991xXR/S+u2hDdnzflT6P7v3fz8dH9VRP/Lrp/wqwnovuXf2B5dH/uixdH9/effXN03wUAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQaWPSxKdEHPvPNBdH9xYfeF93/9FvnRfdX//bY6P6/Xvub0f1Llr8Q3Z9x3Huj++fMmRbdP+bUDdH9oRPeEd2/eMZN0f3Xzh0X3R+dsy+6v/jKb0f3lzy8IrrvAgAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASg2Mnr0t+sDhM5dE91+84GPR/bv+56fR/YELvh7dXzvjkej+qhOfi+7f/ZXvRfc/8e7Lo/sbPnFqdP+UNd+I7p8145zo/u0rVkb3fzmS/X49Ou3p6P61978ruu8CACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKDa4auDL6wPH3Xxjdv+fiZdH9xTMXRPdv/9y06P6vvbI0un/PwQ9E9+dc8/Xo/tCSa6L7Tzy/Mrr/wcffE90fufXE6P7vH3F5dP+4g78T3R9/8R9G948ee1x03wUAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQa2DtvS/SBYwc3RfdnLXkjuv/BWUPR/d84fWJ0f3TWp6P742euj+4PfvX06P4xD90Y3Z/2vwei+/eetiq6//LuI6L7m868Lbp/4fQjo/svrnstun/Wumuj+y4AgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKDUwLoLd0QfuPK9M6P7o7+YFN1/9qIzovtrhrdE97/2cvbn//6Go6P7V+0Zje5/+dYJ0f1LPr87un/wxtXR/Vuf2BTdn//L2dH9l6auie6/8PpwdP+Eaz4a3XcBAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBp7f+KnoA+e//47o/pPjPxvdnzL16Oj+MYe9Gt2f9trz0f39y3ZF98ctvTG6P294VnT/0AP7ovtbrj4qur9g0Uh0f/yjq6L7192W/X599Nns52f0uZei+y4AgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKDU4HUrt0UfWPkPfxHdv2fo0uj+HecfGd3fNnxUdP/6idOj+3f8/Ljo/uZfPSO7v+H66P6DP9gR3d9zyYTo/o/OmxTdv2LbYHR/9BcPRvc/97ffj+7PHZv9/bsAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSA+P+bUr0gb+e9FJ0/7LJ74/u/+efTY/uP3bm49H9d60eiu6v2HlfdP/zS4ej+//4mVOi+yN3vj26P3fo+uj+D8duie4vmnwguj///qnR/eMHVkT3/+nj66L7LgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoNTAnbedH31g0r3jo/tfPeSx6P7mb82J7n/qsAui+5vv3h3df+fOM6P7Y174eHT/qW1vRPfHnfVwdP9rmx+J7l96y/bo/gPbPxTdH/PmIdH9x2cvie5/ZEL274MLAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoNfDYDXujD+z87Pro/l8+PRzd/9kbp0f333rR2uj+aU8cFt1/eGr2f4hLF94e3d//npnR/Q8f+Up0f80P3ozuD1+1MLp/0t9nP/8PbntfdP8L/z05uv9Hv3tZdN8FAFBKAABKCQBAKQEAKCUAAKUEAKCUAACUEgCAUgIAUEoAAEoJAEApAQAoJQAApQQAoJQAAJQSAIBSAgBQSgAASgkAQCkBACglAAClBACglAAAlBIAgFICAFBKAABKCQBAKQEAKCUAAKUEAKCUAACU+r8AAAD//5OogwvfjSe9AAAAAElFTkSuQmCC" alt="Test Sprite" style="display: none;">
        </fixm-spritesheet>
        
        <div class="controls">
            <button onclick="drawRects()">Draw Rectangles</button>
            <button onclick="drawSprite()">Draw Sprite</button>
            <button onclick="playSound()">Play Sound</button>
            <button onclick="animateDemo()">Animate Demo</button>
            <button onclick="inputDemo()">Input Demo</button>
            <button onclick="clearScreen()">Clear</button>
        </div>
        
        <p>320x240 internal resolution, scaled to fit screen with pixel-perfect rendering</p>
        <p>Input: WASD/Arrows + Z/X/C/V or touch controls on mobile</p>
        <div id="input-display" style="margin: 10px 0; font-family: monospace; color: #ccc;"></div>
    </div>
    
    <script src="fixm.js"></script>
    <script>
        // Initialize Fixm with custom settings
        Fixm.init({
            width: 320,
            height: 240,
            mode: 'truecolor'
        });
        
        let animationId;
        let frame = 0;
        let inputDemoActive = false;
        
        function drawRects() {
            Fixm.clear(0x001122);
            
            // Draw some colorful rectangles
            Fixm.drawRect(10, 10, 50, 30, 0xFF0000); // Red
            Fixm.drawRect(70, 15, 40, 25, 0x00FF00); // Green
            Fixm.drawRect(120, 20, 35, 35, 0x0000FF); // Blue
            Fixm.drawRect(200, 10, 60, 20, 0xFFFF00); // Yellow
            Fixm.drawRect(50, 60, 80, 40, 0xFF00FF); // Magenta
            
            // Draw a gradient-like pattern
            for (let x = 0; x < 160; x++) {
                for (let y = 120; y < 140; y++) {
                    const color = (x << 16) | ((y - 120) * 12 << 8) | 128;
                    Fixm.setPixel(x, y, color);
                }
            }
            
            Fixm.present();
        }
        
        function drawSprite() {
            Fixm.clear(0x000044);
            
            // Draw the test sprite multiple times
            for (let i = 0; i < 8; i++) {
                Fixm.blitSub(0, 0, 8, 8, 50 + i * 20, 50 + i * 10, 'test');
            }
            
            Fixm.present();
        }
        
        function playSound() {
            // Play a simple melody
            Fixm.channelSet(0, 440, 'sine'); // A4
            setTimeout(() => Fixm.channelSet(0, 523, 'sine'), 200); // C5
            setTimeout(() => Fixm.channelSet(0, 659, 'sine'), 400); // E5
            setTimeout(() => Fixm.channelSet(0, 0), 600); // Stop
        }
        
        function animateDemo() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
                return;
            }
            
            function animate() {
                frame++;
                
                // Clear with animated background color
                const bgColor = Math.floor(Math.sin(frame * 0.02) * 32 + 32);
                Fixm.clear(bgColor << 16 | bgColor << 8 | bgColor * 2);
                
                // Animated rectangles
                for (let i = 0; i < 5; i++) {
                    const x = Math.sin(frame * 0.03 + i) * 100 + 160;
                    const y = Math.cos(frame * 0.04 + i * 0.5) * 80 + 120;
                    const color = ((frame + i * 50) % 255) << ((i % 3) * 8);
                    Fixm.drawRect(Math.floor(x), Math.floor(y), 20, 20, color);
                }
                
                // Animated sprites
                const spriteX = Math.sin(frame * 0.05) * 140 + 160;
                const spriteY = Math.cos(frame * 0.03) * 100 + 120;
                Fixm.blitSub(0, 0, 8, 8, Math.floor(spriteX), Math.floor(spriteY), 'test');
                
                Fixm.present();
                animationId = requestAnimationFrame(animate);
            }
            
            animate();
        }
        
        function inputDemo() {
            if (inputDemoActive) {
                inputDemoActive = false;
                if (animationId) {
                    cancelAnimationFrame(animationId);
                    animationId = null;
                }
                document.getElementById('input-display').textContent = '';
                return;
            }
            
            inputDemoActive = true;
            
            function updateInputDemo() {
                const gamepad = Fixm.getGamepad(0);
                
                // Clear screen
                Fixm.clear(0x001122);
                
                // Draw player square in center
                let playerX = 150;
                let playerY = 110;
                
                // Move based on input
                if (gamepad & Fixm.BUTTON_LEFT) playerX -= 2;
                if (gamepad & Fixm.BUTTON_RIGHT) playerX += 2;
                if (gamepad & Fixm.BUTTON_UP) playerY -= 2;
                if (gamepad & Fixm.BUTTON_DOWN) playerY += 2;
                
                // Draw player
                Fixm.drawRect(playerX, playerY, 20, 20, 0xFFFFFF);
                
                // Draw button indicators
                if (gamepad & Fixm.BUTTON_A) Fixm.drawRect(10, 10, 30, 20, 0xFF0000);
                if (gamepad & Fixm.BUTTON_B) Fixm.drawRect(50, 10, 30, 20, 0x00FF00);
                if (gamepad & Fixm.BUTTON_X) Fixm.drawRect(90, 10, 30, 20, 0x0000FF);
                if (gamepad & Fixm.BUTTON_Y) Fixm.drawRect(130, 10, 30, 20, 0xFFFF00);
                
                // Display input state
                const inputState = [];
                if (gamepad & Fixm.BUTTON_UP) inputState.push('UP');
                if (gamepad & Fixm.BUTTON_DOWN) inputState.push('DOWN');
                if (gamepad & Fixm.BUTTON_LEFT) inputState.push('LEFT');
                if (gamepad & Fixm.BUTTON_RIGHT) inputState.push('RIGHT');
                if (gamepad & Fixm.BUTTON_A) inputState.push('A');
                if (gamepad & Fixm.BUTTON_B) inputState.push('B');
                if (gamepad & Fixm.BUTTON_X) inputState.push('X');
                if (gamepad & Fixm.BUTTON_Y) inputState.push('Y');
                
                document.getElementById('input-display').textContent = 
                    `Gamepad: 0x${gamepad.toString(16).padStart(2, '0')} | Buttons: ${inputState.join(', ') || 'None'}`;
                
                Fixm.present();
                
                if (inputDemoActive) {
                    animationId = requestAnimationFrame(updateInputDemo);
                }
            }
            
            updateInputDemo();
        }

        function clearScreen() {
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            inputDemoActive = false;
            document.getElementById('input-display').textContent = '';
            Fixm.clear(0x000000);
            Fixm.present();
        }
        
        // Initial demo
        drawRects();
        
        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            switch(e.key) {
                case '1': drawRects(); break;
                case '2': drawSprite(); break;
                case '3': playSound(); break;
                case '4': animateDemo(); break;
                case '5': inputDemo(); break;
                case ' ': clearScreen(); break;
            }
        });
        
        console.log('Fixm Demo Ready!');
        console.log('Controls: 1=Rectangles, 2=Sprites, 3=Sound, 4=Animation, 5=Input, Space=Clear');
        console.log('Input Demo: Use WASD/Arrows to move, Z/X/C/V for buttons, or touch controls on mobile');
    </script>
</body>
</html>